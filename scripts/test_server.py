import shapely.wkt as shwkt
import geopandas as gpd
import requests
from pathlib import Path
import json

def main():
    # geometry = 'MultiPolygon (((9179005.3084421195089817 5663138.53135722782462835, 9179728.39327027834951878 5664965.2719757342711091, 9184637.75868251360952854 5662910.1887799147516489, 9187834.55476490035653114 5659599.22140887193381786, 9192591.69179225899279118 5654613.74180419929325581, 9192553.63469604030251503 5652178.087646191008389, 9190194.09473047032952309 5651683.34539534524083138, 9187035.35574430227279663 5654423.4563231049105525, 9185436.9577031098306179 5657696.36659792810678482, 9182049.87613962963223457 5660055.90656349901109934, 9180223.13552112318575382 5661996.81847066152840853, 9179005.3084421195089817 5663138.53135722782462835)))'
    geometry ='MultiPolygon (((7506333.92107347771525383 6724070.37128446251153946, 7368863.05345722194761038 6724070.37128446251153946, 7368863.05345722194761038 6826632.91770069114863873, 7506333.92107347771525383 6826632.91770069114863873, 7506333.92107347771525383 6724070.37128446251153946)))'

    # geometry = 'Polygon ((8592057.61578512936830521 5361913.5211329897865653, 8592056.64033351838588715 5361913.61720658745616674, 8592055.70236796699464321 5361913.90173532720655203, 8592054.83793396502733231 5361914.36378492787480354, 8592054.08025122433900833 5361914.98559908382594585, 8592053.45843706838786602 5361915.7432818254455924, 8592052.99638746678829193 5361916.60771582834422588, 8592052.71185872703790665 5361917.54568137973546982, 8592052.61578512936830521 5361918.5211329897865653, 8592052.61578512936830521 5460264.78358810767531395, 8592052.71185872703790665 5460265.75903971772640944, 8592052.99638746678829193 5460266.69700526911765337, 8592053.45843706838786602 5460267.56143927294760942, 8592054.08025122433900833 5460268.3191220136359334, 8592054.83793396502733231 5460268.94093616958707571, 8592055.70236796699464321 5460269.40298577025532722, 8592056.64033351838588715 5460269.68751451000571251, 8592057.61578512936830521 5460269.78358810767531395, 8628985.20043831132352352 5460269.78358810767531395, 8628986.17588992230594158 5460269.68751451000571251, 8628987.11385547369718552 5460269.40298577025532722, 8628987.97828947566449642 5460268.94093616958707571, 8628988.7359722163528204 5460268.3191220136359334, 8628989.35778637230396271 5460267.56143927294760942, 8628989.8198359739035368 5460266.69700526911765337, 8628990.10436471365392208 5460265.75903971772640944, 8628990.20043831132352352 5460264.78358810767531395, 8628990.20043831132352352 5361918.5211329897865653, 8628990.10436471365392208 5361917.54568137973546982, 8628989.8198359739035368 5361916.60771582834422588, 8628989.35778637230396271 5361915.7432818254455924, 8628988.7359722163528204 5361914.98559908382594585, 8628987.97828947566449642 5361914.36378492787480354, 8628987.11385547369718552 5361913.90173532720655203, 8628986.17588992230594158 5361913.61720658745616674, 8628985.20043831132352352 5361913.5211329897865653, 8592057.61578512936830521 5361913.5211329897865653))'
    # geometry = 'MultiPolygon (((7921205.4228537930175662 7303897.10814785491675138, 7927094.33523624856024981 7304224.60756063833832741, 7927172.37019929476082325 7301277.60678050294518471, 7930278.07267293613404036 7301181.31831285264343023, 7930500.82297401316463947 7297234.51199122611433268, 7936367.24881932884454727 7297349.99997214321047068, 7936333.96429158188402653 7296156.70642288122326136, 7935888.46368942782282829 7293405.12679584417492151, 7935788.4987866934388876 7284925.57691018562763929, 7931157.4966502021998167 7285425.25013548135757446, 7927205.65472704172134399 7285905.73525428958237171, 7923955.23691536951810122 7281179.04440124426037073, 7922875.3265351839363575 7279508.09294401947408915, 7922474.68768781889230013 7277799.09783467836678028, 7922730.61119715217500925 7274919.61301771271973848, 7922864.19458610564470291 7273441.88872129656374454, 7922897.70175283402204514 7268952.85275667160749435, 7923097.85419727861881256 7264332.21715901046991348, 7922953.13885924685746431 7259848.39680988434702158, 7923042.41709086485207081 7257205.29456750396639109, 7926493.20998596493154764 7257473.3947548745200038, 7926381.89049517177045345 7254218.51263549644500017, 7926136.98761542700231075 7251806.94223836623132229, 7926059.17529136314988136 7249415.24392297677695751, 7925981.0290088253095746 7246833.02871255669742823, 7929754.75974671822041273 7246680.03522969409823418, 7929454.1971215745434165 7242607.68067991267889738, 7929164.87776500359177589 7238824.00637386459857225, 7929120.23864919599145651 7237467.67851625010371208, 7928920.08620474953204393 7236608.15543869975954294, 7925669.33443460334092379 7236741.85284672677516937, 7925713.86223092302680016 7232598.29168954864144325, 7926726.98091663047671318 7232388.30764802731573582, 7925936.61253199819475412 7228647.71497796475887299, 7921851.1872198861092329 7229449.12056047655642033, 7916073.81696720514446497 7230823.14900947548449039, 7916151.62929126992821693 7233400.10060236882418394, 7914809.53479738999158144 7233348.49393989332020283, 7914809.53479738999158144 7303747.02547260001301765, 7921205.4228537930175662 7303897.10814785491675138)))'

    # geom = gpd.GeoSeries([shwkt.loads(geometry)], crs='epsg:3857')
    # geom.to_file('qweqwe.geojson', driver='GeoJSON')
    # return
    path = Path(__file__).absolute().parents[1]

    out = requests.post('http://superres_server:5000/app/v1/perform_sr',
                              json=dict(geometry = geometry,
                                        tci_path ='/home/zhamilya/PycharmProjects/superres/T42UUC_20211017T063851_TCI_10m.jp2')).json()
    # print(out)
    print(out['results'])
    pass


if __name__ == '__main__':
    main()

