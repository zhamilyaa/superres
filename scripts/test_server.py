import shapely.wkt as shwkt
import geopandas as gpd
import requests
from pathlib import Path
import json
import fiona
from shapely.geometry import shape
from shapely.geometry.multipolygon import MultiPolygon
from shapely import wkt
import pyproj
from shapely.ops import transform

def main():
    url = 'http://54.93.234.138:16823/api/v1/superresolution'

    list_of_tiles = "/home/ubuntu/egistic/superres/shp/ukraine_1.shp"
    m = 'MultiPolygon (((3310510.34616971621289849 6307546.54157797154039145, 3309463.6287738298997283 6309522.74913476128131151, 3309428.02340296935290098 6310756.21051782928407192, 3309382.42701483005657792 6312347.25254397932440042, 3307945.7192609366029501 6313724.88410392869263887, 3309583.83322214940562844 6315471.14828725438565016, 3311237.6036422997713089 6317232.80937829427421093, 3312986.67231701593846083 6315554.7681996850296855, 3314520.42137183574959636 6314083.16722750011831522, 3313219.56624621897935867 6311265.06463491637259722, 3312824.54140199534595013 6310844.92004446312785149, 3314443.93220858043059707 6309292.17264208570122719, 3314472.3823711359873414 6308292.75478330627083778, 3314896.35651068761944771 6307886.29706571251153946, 3316159.75752122374251485 6307914.44150451011955738, 3319505.38692023558542132 6310276.31395405437797308, 3321238.29058699449524283 6308616.03108373284339905, 3321420.88062899280339479 6308271.71428948361426592, 3321774.47237887466326356 6309032.32766420766711235, 3324387.37779365666210651 6309084.39945774432271719, 3325383.32067346619442105 6309103.26367455814033747, 3326366.2001971360296011 6309121.86810706369578838, 3326338.83105372451245785 6310113.30875552073121071, 3326300.0544274328276515 6311528.66277447901666164, 3327668.53951786085963249 6312967.5915819089859724, 3331958.71967117954045534 6315226.78356271609663963, 3333195.49016556330025196 6315247.72476990707218647, 3333569.49546230304986238 6315254.06019775755703449, 3334318.96614280762150884 6316855.24549149349331856, 3335239.76521170604974031 6317819.01168649457395077, 3336041.6975827319547534 6320455.42066185921430588, 3336018.93082889029756188 6321294.46224329061806202, 3335964.78759014466777444 6323298.02926951088011265, 3335914.61104048183187842 6325141.39730198495090008, 3334676.9616986233741045 6328563.66132976952940226, 3335790.01682707201689482 6329729.30417729448527098, 3335746.72913598362356424 6331327.36957142502069473, 3337340.5917146154679358 6331352.27593710832297802, 3338717.6329816896468401 6332792.86123853735625744, 3340353.570738909766078 6331221.97269442863762379, 3340683.14393855864182115 6331063.99875255022197962, 3340334.5093978582881391 6331398.96727188304066658, 3343352.70565115474164486 6331442.11863327492028475, 3344328.81762056006118655 6332459.53679017536342144, 3345750.16640665661543608 6332478.9283904517069459, 3346915.39590423926711082 6332494.81902853958308697, 3350329.88134687021374702 6331411.73061154503375292, 3351825.12921167677268386 6329976.20466458331793547, 3351877.78468103101477027 6327970.56238469295203686, 3352407.84706710511818528 6327461.74768208898603916, 3352969.42447551619261503 6328043.97683789115399122, 3352969.42447551619261503 6302017.67793732881546021, 3306627.26234112540259957 6302017.67793732881546021, 3309759.07181632425636053 6305352.92149095330387354, 3310525.59541891794651747 6307014.88895820546895266, 3310510.34616971621289849 6307546.54157797154039145)))'
    # m = 'MultiPolygon (((9179005.3084421195089817 5663138.53135722782462835, 9179728.39327027834951878 5664965.2719757342711091, 9184637.75868251360952854 5662910.1887799147516489, 9187834.55476490035653114 5659599.22140887193381786, 9192591.69179225899279118 5654613.74180419929325581, 9192553.63469604030251503 5652178.087646191008389, 9190194.09473047032952309 5651683.34539534524083138, 9187035.35574430227279663 5654423.4563231049105525, 9185436.9577031098306179 5657696.36659792810678482, 9182049.87613962963223457 5660055.90656349901109934, 9180223.13552112318575382 5661996.81847066152840853, 9179005.3084421195089817 5663138.53135722782462835)))'

    out = requests.post(url=url, json={"area": str(m), "date_of_interest": "2021-6-1", "max_delta_days":60, "min_presence_ratio": 0.95}).json()
    print(out)
    return

    with fiona.open(list_of_tiles, "r") as shapefile:
        shapes = [feature["geometry"] for feature in shapefile]
        for i in range(len(shapes)):
            g2 = shape(shapes[i])
            p = wkt.loads(str(g2))
            m = MultiPolygon([p])
            print(i)
            out = requests.post(url=url, json={"area": str(m), "date_of_interest": "2021-6-1", "max_delta_days":60, "min_presence_ratio": 0.95}).json()
            print(out)
    pass


if __name__ == '__main__':
    main()

